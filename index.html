<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root { --roxo:#7c3aed; }

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:Inter,sans-serif;
}

body{
    width:100vw;
    height:100vh;
    background:url("assets/background.png") center/cover no-repeat;
    overflow:hidden;
    color:#fff;
    position:relative;
}

body::before{
    content:"";
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.25);
    z-index:0;
}

/* ================= LAYOUT ================= */
.container{
    position:relative;
    z-index:1;
    padding:24px 40px;
}

.header{
    display:flex;
    align-items:center;
    gap:10px;
}

.header img{height:36px}
.header span{font-size:15px;opacity:.5}
.header h1{font-size:15px}

/* ================= LOGIN ================= */
.login{
    margin-top:40px;
    max-width:260px;
}

.login h2{font-size:18px}
.login p{
    font-size:11px;
    opacity:.7;
    margin:6px 0 16px;
}

.field{
    position:relative;
    margin-bottom:10px;
}

.field input{
    width:100%;
    height:32px;
    background:rgba(255,255,255,.1);
    border:1px solid rgba(255,255,255,.2);
    border-radius:6px;
    padding:0 34px;
    color:#fff;
    font-size:11px;
}

.field input[disabled]{
    opacity:.9;
}

.field img.icon{
    position:absolute;
    left:10px;
    top:50%;
    transform:translateY(-50%);
    width:14px;
}

.field img.toggle{
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    width:16px;
    cursor:pointer;
}

button{
    width:100%;
    height:32px;
    margin-top:8px;
    background:var(--roxo);
    border:none;
    border-radius:6px;
    color:#fff;
    font-size:12px;
}

/* ================= LOADING ================= */
#loading{
    position:absolute;
    bottom:12px;
    right:16px;
    background:rgba(0,0,0,.55);
    border-radius:9px;
    padding:8px 12px;
    display:flex;
    gap:8px;
    font-size:10px;
    opacity:0;
    pointer-events:none;
    transition:.25s;
    z-index:10;
}

#loading.show{
    opacity:1;
}

.spinner{
    width:14px;
    height:14px;
    border:2px solid rgba(255,255,255,.3);
    border-top:2px solid #fff;
    border-radius:50%;
    animation:spin 1s linear infinite;
}

@keyframes spin{
    to{transform:rotate(360deg)}
}

/* ================= ERRO (TEXTO) ================= */
#errorBox{
    position:absolute;
    left:50%;
    bottom:52px;
    transform:translateX(-50%) translateY(10px);
    background:rgba(255,0,0,.18);
    border:1px solid rgba(255,0,0,.6);
    color:#ff6b6b;
    font-size:11px;
    padding:6px 12px;
    border-radius:6px;
    opacity:0;
    transition:.25s ease;
    z-index:11;
    pointer-events:none;
}

#errorBox.show{
    opacity:1;
    transform:translateX(-50%) translateY(0);
}
</style>
</head>

<body>

<div class="container">
    <div class="header">
        <img src="assets/logo.png">
        <span>|</span>
        <h1 id="tituloTopo">Realizar Login</h1>
    </div>

    <div class="login">
        <h2 id="titulo">Insira suas credenciais</h2>
        <p id="descricao">Insira seu nome de usuário e senha</p>

        <div class="field">
            <img class="icon" src="assets/usuario.png">
            <input type="text" id="usuario" disabled value="Carregando...">
        </div>

        <div class="field" id="emailField" style="display:none">
            <img class="icon" src="assets/email.png">
            <input type="email" id="email" placeholder="Digite seu email">
        </div>

        <div class="field">
            <img class="icon" src="assets/cadeado.png">
            <input type="password" id="senha" placeholder="Digite sua senha">
            <img class="toggle" id="toggleSenha" src="assets/ocultar.png">
        </div>

        <button id="btnPrincipal">Conectar-se</button>
        <button id="btnAlternar">Criar Conta</button>
    </div>
</div>

<div id="loading">
    <div class="spinner"></div>
    <span>Carregando dados</span>
</div>

<div id="errorBox">
    <span id="errorText"></span>
</div>

<script>
/* ================= VARIÁVEIS ================= */
let modo = "login";
let bloqueado = false;

const usuario = document.getElementById("usuario");
const email   = document.getElementById("email");
const senha   = document.getElementById("senha");
const loading = document.getElementById("loading");

const errorBox  = document.getElementById("errorBox");
const errorText = document.getElementById("errorText");

const btnPrincipal = document.getElementById("btnPrincipal");
const btnAlternar  = document.getElementById("btnAlternar");

const emailField = document.getElementById("emailField");
const titulo     = document.getElementById("titulo");
const tituloTopo = document.getElementById("tituloTopo");
const toggleSenha= document.getElementById("toggleSenha");

/* ================= FUNÇÃO DE ERRO (SEM ALERT) ================= */
function showError(msg){
    errorText.innerText = "* " + msg;

    loading.classList.remove("show");
    bloqueado = false;

    errorBox.classList.add("show");
    errorBox.offsetHeight; // força repaint no mobile

    setTimeout(()=>{
        errorBox.classList.remove("show");
    },3000);
}

/* ================= TOGGLE SENHA ================= */
toggleSenha.onclick = ()=>{
    senha.type = senha.type === "password" ? "text" : "password";
};

/* ================= CEF CALLBACKS ================= */
Cef.registerEventCallback("setNick", nick=>{
    if(nick) usuario.value = nick;
});

Cef.registerEventCallback("loginError", msg=>{
    showError(msg);
});

Cef.registerEventCallback("registerError", msg=>{
    showError(msg);
});

Cef.registerEventCallback("loginSuccess", ()=>{
    loading.classList.remove("show");
});

Cef.registerEventCallback("registerSuccess", ()=>{
    loading.classList.remove("show");
});

/* ================= BOTÃO PRINCIPAL ================= */
btnPrincipal.onclick = ()=>{
    if(bloqueado) return;

    if(!senha.value)
        return showError("Preencha sua senha.");

    if(modo==="register" && !email.value)
        return showError("Preencha seu e-mail.");

    bloqueado = true;
    loading.classList.add("show");

    setTimeout(()=>{
        if(modo==="register")
            Cef.sendEvent("register", senha.value + "|" + email.value);
        else
            Cef.sendEvent("login", senha.value);
    },4000);
};

/* ================= TROCAR LOGIN / REGISTRO ================= */
btnAlternar.onclick = ()=>{
    if(modo==="login"){
        modo="register";
        emailField.style.display="block";
        btnPrincipal.innerText="Criar Conta";
        btnAlternar.innerText="Conectar-se";
        titulo.innerText="Crie sua conta";
        tituloTopo.innerText="Criar Conta";
    }else{
        modo="login";
        emailField.style.display="none";
        btnPrincipal.innerText="Conectar-se";
        btnAlternar.innerText="Criar Conta";
        titulo.innerText="Insira suas credenciais";
        tituloTopo.innerText="Realizar Login";
    }
};
</script>

</body>
</html>
